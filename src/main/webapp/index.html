<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="http://192.168.0.20:8080/auth/js/keycloak.js"></script>
        <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
        <link href="main.css" rel="stylesheet" type="text/css"/>
    </head>
    <body>        
        <a href="main.html">Основная страница</a>
        <div class="popup_overlay"></div>
        <div class="popup">
            <div class="popup_title">
                Заголовок всплывающего окна <span class="closer">X</span>
            </div>
            <div class="popup_content">
                <div id="user_id"></div>
            </div>
        </div>
        <p id="test"></p>
    </body>
    <script>
        var keycloak = Keycloak();
        var userid;
        keycloak.init({onLoad: 'login-required'}).success(function (authenticated) {
            var token = keycloak.token;
            console.log(keycloak);
            console.log(keycloak.idTokenParsed.sub);

            $.ajax({
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                url: "http://192.168.0.20:8080/adminRest_b2b/api/realms/videomanager/users/" + keycloak.idTokenParsed.sub,
                method: 'GET'
            }).then(function (data) {
                console.log(data);
                for (var key in data.attributes) {
                    if (/id_app_1/i.test(key)) {
                        console.log("key = " + key + " val = " + data.attributes[key]);                        
                        var t = $("<div>");
                        t.attr("id", key);
                        t.html(data.attributes[key]);
                        t.data(data.attributes[key]);
                        $("#user_id").append(t);
                        $('#' + key).on("click", function () {
                            console.log($(this).data());
                            userid = $(this).data();
                        });

                    }
                }
                

                console.log(userid);

                $('.closer,.popup_overlay').click(function () {
                    console.log(userid[0]);
                    $("#test").html('<p>' + userid[0] + "</p>");
                    $('.popup,.popup_overlay').fadeOut(400); //скрываем всплывающее окно
                });
                $('.popup,.popup_overlay').fadeIn(400);
            });
        }).error(function () {
            console.log('failed to initialize');
        });
    </script>    
</html>
